{
  "name": "Woocommerce create order & get order data",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -960,
        -128
      ],
      "id": "172ab302-3f4b-46f4-ae2e-0725873c463e",
      "name": "When chat message received",
      "webhookId": "caaedf18-2815-4d59-a497-de2159867614"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "الهدف العام:\nعند استلام طلب يحتوي على أكثر من منتج، يجب إنشاء أوردر واحد فقط باستخدام أداة CREATE ثم إضافة باقي المنتجات إلى نفس الأوردر باستخدام أداة UPDATE، كل مرة منتج واحد فقط.\n\nجمع معلومات العميل:\nاطلب الاسم الكامل.\nاطلب رقم الهاتف.\nاطلب ايميل العميل\nاطلب العنوان (المحافظة و المدينة و الشارع ).\nاطلب قائمة المنتجات المطلوبة مع الكميات الدقيقة لكل منتج.\n\nمنطق إنشاء الأوردر (قواعد صارمة):\n3.1) إذا الطلب يحتوي على منتج واحد فقط:\n- استعمل أداة CREATE لإنشاء الأوردر بالمنتج الوحيد.\n- لا تنفذ أي CREATE إضافي لنفس الطلب.\n3.2) إذا الطلب يحتوي على أكثر من منتج:\n- نفّذ أداة CREATE مرة واحدة فقط، وضمنها أول منتج فقط مع بيانات العميل.\n- بعد إتمام CREATE استلم رقم الأوردر (Order ID).\n- لكل منتج متبقٍ في الطلب، نفّذ عملية UPDATE منفصلة واحدة لكل منتج، استخدم فيها Order ID الذي حصلت عليه من CREATE.\n- لا تستخدم CREATE لأي منتج آخر بعد أول CREATE. كل الإضافات يجب أن تكون عن طريق UPDATE واحدة لكل منتج.\n\nمتى يعتبر التنفيذ صحيح:\n\nيجب أن ينتج عن العملية أوردر واحد في WooCommerce يمثل كل منتجات العميل بعد اكتمال كل تحديثات الـ UPDATE.\n\nلا تُسجّل أكثر من أوردر واحد لنفس طلب العميل أبداً.\n\nمتطلبات البيانات عند كل عملية:\n\nفي CREATE: أرسل بيانات العميل كاملة + أول منتج (مع الكمية).\n\nفي كل UPDATE: أرسل Order ID + بيانات المنتج الذي تود إضافته (الاسم/المعرف/الكمية).\n\nتأكد من أن كل UPDATE يضيف منتجًا واحدًا فقط ولا يكرر منتجات سبق إضافتها.\n\nرسالة تأكيد للعميل بعد كل خطوة:\n\nبعد CREATE: أعطِ العميل تأكيدًا، وأبلغّه برقم الأوردر (Order ID).\nوارسل له رابط الدفع \nبعد كل UPDATE ناجح: أخبر العميل أي منتج تمت إضافته وأن الأوردر الآن يحتوي على X منتجات (اختياري).\n\nعند اكتمال كل الإضافات: أرسل ملخص نهائي للطلب (المنتجات، الكميات، السعر الكلي، وتفاصيل الشحن).\n\nملاحظات تقنية وتنبيهات:\n\nإذا فشل UPDATE لأي سبب، فقط أعد محاولة UPDATE لنفس المنتج (لا تنشئ CREATE جديد).\n\nلا تقم بعمليات CREATE متزامنة لنفس العميل أو نفس الجلسة. استخدم CREATE مرة واحدة فقط لكل طلب زبون.\n\nسجل كل استجابة من واجهة WooCommerce (خاصة Order ID وstatus) للتمكين من التتبع والتصحيح.\n\n\n--------------\n\nاذا اراد الاستفسار عن الاوردر الخاص به \nستحتاج منه رقم الاوردر و رقم الهاتف\nستستخدم رقم الاوردر للاستعلام عن بيانات الاوردر\nوتتأكد ان رقم الهاتف مطابق لبيانات الاوردر حتي لا يصل الى بيانات اوردرات غير تابعه له \n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        -560,
        -144
      ],
      "id": "f9155519-99a7-4180-a980-75b92f81f1be",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -944,
        288
      ],
      "id": "6b1c8a3f-97fb-4939-ac6a-865ba680a7b4",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "JcwIFXVK9Lxo9lj2",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "899993",
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -720,
        288
      ],
      "id": "53b815ba-8abc-48c1-84a1-8525a9e48bae",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "operation": "getAll",
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        -480,
        272
      ],
      "id": "75711d95-ddf6-47df-ba1b-dca10f0d094a",
      "name": "Get many products in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "order",
        "additionalFields": {},
        "billingUi": {
          "billingValues": {
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
            "company": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company', ``, 'string') }}",
            "address_1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_1', ``, 'string') }}",
            "address_2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_2', ``, 'string') }}",
            "city": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
            "postcode": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Postal_Code', ``, 'string') }}",
            "country": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Country', ``, 'string') }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}",
            "phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}"
          }
        },
        "lineItemsUi": {
          "lineItemsValues": [
            {
              "name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Name', ``, 'string') }}",
              "productId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Product_ID', ``, 'number') }}",
              "variationId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Variation_ID', ``, 'number') }}",
              "quantity": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Quantity', ``, 'number') }}",
              "taxClass": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Tax_Class', ``, 'string') }}",
              "subtotal": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Subtotal', ``, 'string') }}",
              "total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Total', ``, 'string') }}"
            }
          ]
        },
        "shippingUi": {
          "shippingValues": {
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
            "company": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company', ``, 'string') }}",
            "address_1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_1', ``, 'string') }}",
            "address_2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_2', ``, 'string') }}",
            "city": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
            "postcode": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Postal_Code', ``, 'string') }}",
            "country": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Country', ``, 'string') }}"
          }
        }
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        -64,
        256
      ],
      "id": "a5dbc5ef-c8af-4614-88ef-19812cfa54d0",
      "name": "Create an order in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "Update an order in WooCommerce , also use if order have more than one item to add other items to order",
        "resource": "order",
        "operation": "update",
        "orderId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Order_ID', ``, 'string') }}",
        "updateFields": {},
        "billingUi": {
          "billingValues": {
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
            "company": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company', ``, 'string') }}",
            "address_1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_1', ``, 'string') }}",
            "address_2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_2', ``, 'string') }}",
            "city": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
            "postalCode": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Postal_Code', ``, 'string') }}",
            "country": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Country', ``, 'string') }}",
            "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}",
            "phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}"
          }
        },
        "lineItemsUi": {
          "lineItemsValues": [
            {
              "name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Name', ``, 'string') }}",
              "productId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Product_ID', ``, 'number') }}",
              "variationId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Variation_ID', ``, 'number') }}",
              "quantity": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Quantity', ``, 'number') }}",
              "taxClass": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Tax_Class', ``, 'string') }}",
              "subtotal": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Subtotal', ``, 'string') }}",
              "total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('lineItemsValues0_Total', ``, 'string') }}"
            }
          ]
        },
        "shippingUi": {
          "shippingValues": {
            "firstName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
            "lastName": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
            "company": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Company', ``, 'string') }}",
            "address_1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_1', ``, 'string') }}",
            "address_2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_Line_2', ``, 'string') }}",
            "city": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
            "postalCode": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Postal_Code', ``, 'string') }}",
            "country": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Country', ``, 'string') }}"
          }
        }
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        128,
        256
      ],
      "id": "c6065e1f-801d-4f55-93f1-138f9b46cb46",
      "name": "Update an order in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "order",
        "operation": "get",
        "orderId": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Order_ID', ``, 'string') }}"
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        -256,
        272
      ],
      "id": "5c8587a9-fe27-4b58-975c-aef51bc0c771",
      "name": "Get an order in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      }
    },
    {
      "parameters": {
        "resource": "customer",
        "operation": "getAll",
        "limit": 1,
        "filters": {
          "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}"
        }
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        240,
        144
      ],
      "id": "cf5678e6-76ac-488a-a0e9-14c13c2d8dbf",
      "name": "Get many customers in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "resource": "customer",
        "email": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Email', ``, 'string') }}",
        "additionalFields": {
          "billing": {},
          "first_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
          "last_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
          "shipping": {
            "first_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('First_Name', ``, 'string') }}",
            "last_name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Last_Name', ``, 'string') }}",
            "address_1": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_1', ``, 'string') }}",
            "address_2": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Address_2', ``, 'string') }}",
            "city": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('City', ``, 'string') }}",
            "state": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('State', ``, 'string') }}",
            "phone": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Phone', ``, 'string') }}"
          }
        }
      },
      "type": "n8n-nodes-base.wooCommerceTool",
      "typeVersion": 1,
      "position": [
        416,
        64
      ],
      "id": "08380ea0-d3c7-4933-b4bc-f4c1dcb4c2da",
      "name": "Create a customer in WooCommerce",
      "credentials": {
        "wooCommerceApi": {
          "id": "9upsoR37aBS40mu4",
          "name": "WooCommerce account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "content": "## تم الانشاء بواسطة \nتم الانشاء بواسطة **م. أحمد الصيرفي**  \n\nللتعلّم وتطوير مهاراتك في الأتمتة، زور موقعنا: \n [ahmedelserafy.com](https://ahmedelserafy.com/automation_course)",
        "height": 224,
        "width": 336
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -592,
        -432
      ],
      "typeVersion": 1,
      "id": "6a0aa604-22e0-4942-abe1-1768ee9b0435",
      "name": "Sticky Note"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get many products in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create an order in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Update an order in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get an order in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Get many customers in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Create a customer in WooCommerce": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "62617a69-3375-4b65-9571-2a8d83a21fa8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "eb58054caf61c2552d4b13cc032edccc043473990c2938118b79640890b4e573"
  },
  "id": "fEB76X1m6ZfWIdF2",
  "tags": []
}